#!/usr/bin/env zsh

FILE="${1}"
OUT="${2}"

TEXT=$(cat "${FILE}")

echo "Usage: roam-md-to-html [file.md] <output.html>"
echo "  - Outputs to stdout if no output file is specified"
echo "  - Converts markdown to html using the GitHub API"
echo "  - This only works with markdown as generated by the Roam Export Formatter from Roam Depot"

[[ -z "${FILE}"]] && exit
[[ -z "${TEXT}"]] && echo "${FILE} is empty" && exit

gh api \
    --method POST \
    -H "Accept: application/vnd.github+json" \
    -H "X-Github-Api-Version: 2022-11-28" \
    /markdown \
    -f text="$TEXT" -f mode='gfm' > /tmp/roam-md-to-html.html

[[ -n "${OUT}" ]] && cp roam-md-to-html.html "${OUT}" || cat roam-md-to-html.html

rm roam-md-to-html.html


